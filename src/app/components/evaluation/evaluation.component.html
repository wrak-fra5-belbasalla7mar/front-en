<div class="container mt-4">
  <h2 class="mb-4">Team Member Evaluation</h2>

  <!-- Error Message -->
  <div class="alert alert-danger" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <!-- Loading Spinner -->
  <div class="text-center" *ngIf="isLoading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="row" *ngIf="!isLoading && !errorMessage">
    <!-- Team Members List (Left Side) -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Team Members</h5>
          <ul class="list-group">
            <li
              class="list-group-item list-group-item-action"
              *ngFor="let member of team?.members"
              (click)="selectMember(member)"
              [class.active]="selectedMember?.userId === member.userId"
            >
              {{ member.name }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Evaluation Form (Right Side) -->
    <div class="col-md-8">
      <div class="card shadow-sm" *ngIf="selectedMember; else noMemberSelected">
        <div class="card-body">
          <h5 class="card-title mb-3">Evaluate {{ selectedMember.name }}</h5>

          <!-- Cycle Selection -->
          <div class="mb-3">
            <label for="cycleSelect" class="form-label">Select Evaluation Cycle</label>
            <select
              id="cycleSelect"
              class="form-select"
              [(ngModel)]="selectedCycleId"
              (change)="loadKPIs()"
            >
              <option *ngFor="let cycle of cycles" [value]="cycle.id">
                {{ cycle.name }} ({{ cycle.startDate }} - {{ cycle.endDate }})
              </option>
            </select>
          </div>

          <!-- KPIs Evaluation -->
          <div *ngIf="evaluationKpis.length > 0; else noKPIs">
            <div class="mb-3" *ngFor="let kpi of evaluationKpis; let i = index">
              <h6>{{ kpi.kpi.name }}</h6>
              <div class="row">
                <div class="col-md-6 mb-2">
                  <label [for]="'score-' + i" class="form-label">Score (1 - {{ kpi.kpi.maxScore || 5 }})</label>
                  <input
                    type="number"
                    [id]="'score-' + i"
                    class="form-control"
                    [(ngModel)]="kpi.score"
                    [min]="1"
                    [max]="kpi.kpi.maxScore || 5"
                    required
                  />
                </div>
                <div class="col-md-6 mb-2">
                  <label [for]="'feedback-' + i" class="form-label">Feedback</label>
                  <textarea
                    [id]="'feedback-' + i"
                    class="form-control"
                    [(ngModel)]="kpi.feedback"
                    rows="2"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Save Button -->
            <button class="btn btn-success" (click)="saveEvaluation()" [disabled]="isLoading">
              Save Evaluation
            </button>
          </div>

          <!-- No KPIs Message -->
          <ng-template #noKPIs>
            <div class="alert alert-warning">
              No KPIs available for the selected cycle.
            </div>
          </ng-template>
        </div>
      </div>

      <!-- No Member Selected Message -->
      <ng-template #noMemberSelected>
        <div class="alert alert-info">
          Please select a team member to evaluate.
        </div>
      </ng-template>
    </div>
  </div>
</div>